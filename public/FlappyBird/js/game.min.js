(function(){"use strict";function t(){this.bird=null;this.jumpButton=null;this.blockGroup=null;this.scoreText=null;this.logUrl="//"+document.domain+"/Playing"}t.prototype={create:function(){this.add.sprite(0,0,"background");this.game.physics.startSystem(Phaser.Physics.ARCADE);this.setupVariables();this.createBird();this.createBlocks();this.scoreText=this.add.bitmapText(40,20,"gamefont",""+this.score);this.scoreText.scale.setTo(4,4);this.game.input.onDown.add(this.flap,this)},setupVariables:function(){this.score=0;this.numberOfBlocks=5;this.blockSpacing=600;this.verticalSpacing=400;this.lastBlock=0;this.lastY=300;this.backgroundInitSpeed=400;this.descendSpeed=250;this.game.lastFlapTime=(new Date).getTime();this.direction=-1;this.lastUpdateScore=-1},createBird:function(){this.bird=this.add.sprite(400,this.lastY,"bird");this.bird.anchor.set(.5);this.bird.animations.add("fly");this.bird.animations.play("fly",10,true);this.physics.arcade.enable(this.bird);this.bird.body.bounce.y=.1;this.bird.body.gravity.y=this.descendSpeed;this.bird.body.velocity.x=0;this.bird.body.collideWorldBounds=true},createBlocks:function(){this.blockGroup=this.add.group();this.blockGroup.enableBody=true;this.blockGroup.physicsBodyType=Phaser.Physics.ARCADE;for(var t=0;t<this.numberOfBlocks;++t){var i=this.game.width+t*this.blockSpacing;var s=this.getNewYPosition();this.lastY=s;this.lastBlock=i;var e=this.blockGroup.create(i,s,"block-top");e.anchor.setTo(.5,1);e.body.immovable=true;var a=this.verticalSpacing;if((new Date).getTime()-this.lastChangeDirectionTime<1e3){a+=300}var o=this.blockGroup.create(i,s+a,"block-bottom");o.anchor.setTo(.5,0);o.body.immovable=true}},update:function(){this.physics.arcade.collide(this.bird,this.blockGroup,this.gameOver,null,this);this.updateBird();this.updateBlocks()},updateBird:function(){if(this.game.didFlap){this.flap()}else{var t=((new Date).getTime()-this.game.lastFlapTime)/1e3;this.bird.body.gravity.y+=this.direction*this.descendSpeed*t}if(this.direction==-1){this.bird.rotation=-3.14}else{this.bird.rotation=0}if(this.direction==1&&this.bird.y>875||this.direction==-1&&this.bird.y<=100){this.gameOver()}},flap:function(){this.bird.body.velocity.y=-this.direction*350;this.game.didFlap=false;this.bird.body.gravity.y=this.direction*this.descendSpeed;this.game.lastFlapTime=(new Date).getTime()},updateBlocks:function(){var i=0;var s=0;var e=false;this.blockGroup.forEach(function(t){t.body.velocity.x=-this.getCurrentBackgroundSpeed();if(!t.scored&&t.x+t.width*.5<this.bird.x-this.bird.width*.5){e=true;t.scored=true}if(t.x>i){i=t.x}else if(t.x<-200){if(s===0){s=this.getNewYPosition()}t.x=this.lastBlock+this.blockSpacing;if(t.anchor.y===1){t.y=s}else{t.y=s+this.verticalSpacing}t.scored=false}},this);if(s!==0){this.lastY=s}this.lastBlock=i;if(e){++this.score;this.scoreText.setText(""+this.score)}if(this.score%3==0&&this.score>this.lastUpdateScore){$.ajax({url:this.logUrl,type:"post",data:{data:encrypt('{"score" : '+this.score+"}")}});this.lastUpdateScore=this.score;this.direction*=-1}},getNewYPosition:function(){var t=0;do{t=200+Math.random()*400}while(this.lastY-t>200||this.lastY-t<-200);return t},getCurrentBackgroundSpeed:function(){var t=this.backgroundInitSpeed*1*(this.score/10+1);if(t>1500)t=1500;return t},gameOver:function(){this.game.state.states["menu"].score=this.score;this.game.state.start("menu")}};window["flappybird"]=window["flappybird"]||{};window["flappybird"].Game=t})();